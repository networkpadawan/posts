Title: CCNP Route - OSPF Fundamentals
Author: Tiago Sousa
Date: 2011-07-06 21:35:43
Tags: CCNP, Certification, OSPF, ROUTE


This stuff must be known/memorized/drilled to the mind/you name it!

OSPF, as a Link State protocol maintains three tables:



	
  * Neighbor tables - Tracks all the directed, OSPF enabled routers

	
  * Topology table or Link State DataBase - States the topology created with LSA´s

	
  * Routing Table - After the calculations, adds the best paths to every network





## OSPF Areas


An area is a logical collection of OSPF networks, routers, and links that have the same area identification.

**Area Types:**

**Backbone area**: Area 0, which is attached to every other area.

**Regular area:** Non backbone area; its database contains both internal and external routes.

**Stub area:** It’s database contains only internal routes and a default route.

**Totally Stubby Area:** Cisco proprietary area designation. Its database contains routes only for its own area and a default route.

**Not-so-stubby area (NSSA):** Its database contains internal routes, routes redistributed from a connected routing process, and optionally a default route.

**Totally NSSA:** Cisco proprietary area designation. Its database contains only routes for its own area, routes redistributed from a connected routing process, and a default route.




## OSPF router roles


**An internal router** has all interfaces in one area. In Figure 3-1, R1, R2, and R5 are all internal area routers. They maintain a link-state database for their own area only.

**Backbone routers** have at least one interface assigned to area 0. R3, R4, and R5 are backbone routers.

**ABR - Area Border Router -** has interfaces in two or more areas. ABRs separates LSA flooding areas, can summarize area routes, and can source default routes. They maintain a link-state database for each area to which they are connected.

**ASBR - An Autonomous System Boundary Router -** has interfaces inside and outside the OSPF routing domain. I

Remember: one router can have multiple roles




## **OSPF Metric**


Cost=100 Mbps/Bandwidth

to recalculate use

_auto-cost reference-bandwidth 1000_
(remember to change on **ALL** routers for consistency)

or manually assigned on each interface

_ip ospf cost 27 (1 to 65535_




## **OSPF Packets**


OSPF uses five packet types. It does not use UDP or TCP for transmitting its packets. Instead, it runs directly over IP (IP protocol 89).

**Hello:** Identifies neighbors and serves as a keepalive.

**Link State Request (LSR):** Request for a Link State Update (LSU). Contains the type of LSU requested and the ID of the router requesting it.

**Database Description (DBD):** A summary of the LSDB, including the RID and sequence number of each LSA in the LSDB.

**Link State Update (LSU)**: Contains a full LSA entry. An LSA includes topology information; for example, the RID of this router and the RID and cost to each neighbor. One LSU can contain multiple LSAs.

**Link State Acknowledgment (LSAck):** Acknowledges all other OSPF packets (except Hellos).

OSPF traffic is multicast to either of two addresses: 224.0.0.5 for all OSPF routers or 224.0.0.6 for all OSPF DRs.




## **Link State Advertisement**


LSA´s are the packet used by OSPF routers to communicate. It has a sequence number to maintain the DB updated, and always starts with 0x80000001. A new LSA is issued under two conditions:



	
  * The LSA changes because a route is added or deleted.

	
  * The LSA ages out. (LSA updates are flooded within the area every half hour, even if nothing changes.)


**OSPF LSA Types**

**Type 1 - Router LSA** -  Advertises intra-area routes. Generated by each OSPF router. Flooded only within the area 0

**Type 2 - Network LSA** - Advertises routers on a multiaccess link. Generated by a DR. Flooded only within the area 0

**Type 3 - Summary LSA** - Advertises interarea routes. Generated by an ABR. Flooded to adjacent areas

**Type 4 - Summary LSA** - Advertises the route to an ASBR. Generated by an ABR. Flooded to adjacent areas

**Type 5 - External LSA** - Advertises routes in another routing domain. Generated by an ASBR. Flooded to adjacent areas

**E1**–metric increases at each router as it is passed through the network

**E2**–metric does not increase (this is the default)

**Type 6 - Multicast LSA** - Used in multicast OSPF operations

**Type 7 - Not-so-stubby area (NSSA)** - LSA. Advertises routes in another routing domain. Generated by an ASBR within a not-so-stubby area.
E1–metric increases as it is passed through the network.
E2–metric does not increase (default)


## **OSPF Neighbors**


OSPF Neighbors are directly connected OSPF enabled routers

**Neighbor Status**

**Down** - Initial State, OSPF process not started, no hello packets sent.

**Attempt** - [NBMA networks only] Router sends unicast hello packets every poll interval until dead interval is reached

**Init** -Router received a hello packet and checks:



	
  * Hello / Dead Interval

	
  * Area ID

	
  * Netmask

	
  * Authentication

	
  * MTU

	
  * Stub area flag


If all ok Send Hello and RID is contained in the packet - Send packet to reset hello/dead timer. If not, continue the process.

**2 - Way** - Bi-directional "hello" communication has been established. (the router received a hello packet with own router-id within the neighbor field). Also receiving a DBD packet from a neighbor in the _init state_ will also a cause a transition to 2-way state.

**Ex-Start** - Checking the master / slave relation (who starts the exchange process - 1st to send DBD), its determined by the priority and the router-id breaks the tie if needed

**Loading** - Comparing DBD´s and matching with own LSDB

**Full** - Neighbors are fully adjacent

Remember: OSPF routers can be neighbors without being adjacent. Only adjacent neighbors exchange routing updates and synchronize their databases. On a point-to-point link, an adjacency is established between the two routers when they can communicate. On a multiaccess link, each router establishes an adjacency only with the DR and the backup DR (BDR).




## **Designated Router and Backup Designated Router**


The DR and BDR are needed and elected on Broadcast(LAN) and NBMA Networks, one of each exister per broadcast segment(ie.:vlan)

Is elected as follow:



	
  * The Router with the highest priority gets elected (default is 1, and priority of 0 removes the router from DR/BDR election process)

	
  * With the same priority, the highest RID wins


**The RID - Router-ID** is chosen by this order



	
  1. router-id x.x.xx command

	
  2. highest loopback ip address

	
  3. highest up/up interface ip address





## **Network Types**


**NBMA:** Default for multipoint serial interfaces. RFC-compliant mode that uses DRs and requires manual neighbor configuration.

**Point-to–multipoint (P2MP):** Doesn’t use DRs so adjacencies increase logarithmically with routers. Resilient RFC-compliant mode that automatically discovers neighbors.

**Point-to-multipoint nonbroadcast (P2MNB):** Proprietary mode that is used on Layer 2 facilities where
dynamic neighbor discovery is not supported. Requires manual neighbor configuration.

**Broadcast:** Default mode for LANs. Uses DRs and automatic neighbor discovery. Proprietary when used on WAN
interface.

**Point-to–point (P2P):** Proprietary mode that discovers neighbors and doesn’t require a DR. If the default interface type is unsatisfactory, you can statically configure it with the command ip ospf network under interface configuration mode:
Router(config-if)# _ip ospf network point-to-multipoint_










NBMA


Multipoint Broadcast


Multipoint NonBroadcast


Broadcast


Point-to-Point






DR/BDR?


Yes


No


No


Yes


No






Neighbor Discovery


Manual


Auto


Manual


Auto


Auto






Timers


30/120


30/120


30/120


10/40


10/40






Proprietary


No


No


Yes


Yes


Yes






Full Mesh


Any


Any


Any


Full Mesh


Point-to-Point




Remember: When using the NBMA or P2MP nonbroadcast mode, neighbors must be manually defined under the routing process:

Router(config-router)# _neighbor 172.16.0.1_ 